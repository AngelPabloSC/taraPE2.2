<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Carga de im√°genes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Preload de la imagen que m√°s se ve (primera de la galer√≠a) -->
    <link rel="preload" as="image" href="1.sm.webp" />

    <style>
      :root {
        --primary: #1976d2;
        --primary-light: #e3f2fd;
        --bg: #f5f5f5;
        --card-bg: #ffffff;
        --border-radius: 16px;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        --skeleton-base: #e0e0e0;
        --skeleton-highlight: #f5f5f5;
        --text-main: #212121;
        --text-muted: #4a4a4a;
        --text-small: #555555;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg);
        color: var(--text-main);
      }

      /* Enlace para saltar al contenido principal (accesibilidad teclado) */
      .skip-link {
        position: absolute;
        top: 8px;
        left: 8px;
        padding: 8px 12px;
        background: #000;
        color: #fff;
        border-radius: 4px;
        text-decoration: none;
        z-index: 20;
        transform: translateY(-150%);
        transition: transform 0.15s ease;
      }

      .skip-link:focus-visible {
        transform: translateY(0);
      }

      .app-wrapper {
        width: 100%;
        max-width: 900px;
        padding: 16px;
      }

      .card {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        padding: 32px;
        box-shadow: var(--shadow);
      }

      .title {
        text-align: center;
        font-size: 1.5rem;
        margin-bottom: 4px;
      }

      .subtitle {
        text-align: center;
        font-size: 0.95rem;
        color: var(--text-muted);
        margin-bottom: 24px;
      }

      .center {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        margin-bottom: 24px;
      }

      .btn {
        border: none;
        outline: none;
        border-radius: 999px;
        padding: 10px 20px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: transform 0.1s ease, box-shadow 0.1s ease,
          background 0.1s ease;
      }

      .btn-outlined {
        background: #fff;
        border: 1px solid #b0b0b0;
        color: var(--text-main);
      }

      .btn-contained {
        width: 100%;
        background: var(--primary);
        color: #fff;
        margin-top: 4px;
        box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
      }

      .btn-text {
        background: transparent;
        border-radius: 8px;
        padding: 6px 10px;
        font-size: 0.8rem;
        color: #c62828;
        border: 1px solid rgba(198, 40, 40, 0.25);
      }

      .btn:active {
        transform: translateY(1px);
        box-shadow: none;
      }

      .btn[disabled] {
        opacity: 0.6;
        cursor: default;
        box-shadow: none;
      }

      /* Estilo de foco visible para accesibilidad teclado */
      .btn:focus-visible,
      input:focus-visible {
        outline: 3px solid #000;
        outline-offset: 2px;
      }

      .file-info {
        font-size: 0.85rem;
        color: var(--text-small);
      }

      .file-info strong {
        font-weight: 600;
      }

      .preview {
        display: flex;
        justify-content: center;
        margin-bottom: 24px;
      }

      .preview-image {
        width: 200px;
        height: 200px;
        border-radius: 24px;
        object-fit: cover;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
      }

      .progress-bar {
        width: 100%;
        height: 4px;
        border-radius: 999px;
        background: #eee;
        overflow: hidden;
        margin-bottom: 12px;
        display: none;
      }

      .progress-inner {
        height: 100%;
        width: 100%;
        background: var(--primary);
        animation: loading 1s infinite linear;
        transform-origin: left;
      }

      @keyframes loading {
        0% {
          transform: scaleX(0);
        }
        50% {
          transform: scaleX(1);
        }
        100% {
          transform: scaleX(0);
        }
      }

      .gallery-section {
        margin-top: 32px;
      }

      .gallery-title {
        font-size: 1.1rem;
        margin-bottom: 12px;
      }

      .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 16px;
      }

      .gallery-card {
        background: #fff;
        border-radius: 12px;
        padding: 10px;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .gallery-img {
        width: 100%;
        height: 140px;
        border-radius: 10px;
        object-fit: cover;
      }

      .gallery-name {
        font-size: 0.9rem;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }

      .gallery-size {
        font-size: 0.75rem;
        color: var(--text-small);
      }

      .gallery-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }

      /* Skeleton */
      .skeleton-card {
        background: #fff;
        border-radius: 12px;
        padding: 10px;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.04);
      }

      .skeleton-block,
      .skeleton-line {
        background: linear-gradient(
          90deg,
          var(--skeleton-base),
          var(--skeleton-highlight),
          var(--skeleton-base)
        );
        background-size: 200% 100%;
        animation: shimmer 1.2s infinite;
        border-radius: 8px;
      }

      .skeleton-block {
        width: 100%;
        height: 140px;
        margin-bottom: 8px;
      }

      .skeleton-line {
        height: 10px;
        margin-bottom: 6px;
      }

      .skeleton-line.short {
        width: 50%;
      }

      .skeleton-line.long {
        width: 80%;
      }

      @keyframes shimmer {
        0% {
          background-position: -200% 0;
        }
        100% {
          background-position: 200% 0;
        }
      }

      /* Dialog gen√©rico mensajes */
      .dialog-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.3);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10;
      }

      .dialog {
        background: #fff;
        border-radius: 12px;
        padding: 20px 24px;
        max-width: 360px;
        width: 100%;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .dialog-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .dialog-header.success {
        color: #2e7d32;
      }

      .dialog-header.error {
        color: #c62828;
      }

      .dialog-body {
        font-size: 0.9rem;
        color: #555;
        margin-bottom: 12px;
      }

      .dialog-footer {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 20px;
        height: 20px;
        border-radius: 999px;
        font-size: 0.8rem;
        font-weight: 700;
        color: #fff;
      }

      .chip.success {
        background: #2e7d32;
      }

      .chip.error {
        background: #c62828;
      }
    </style>
  </head>
  <body>
    <!-- Enlace para lectores de pantalla / teclado -->
    <a href="#mainContent" class="skip-link">Saltar al contenido principal</a>

    <main id="mainContent" tabindex="-1">
      <div class="app-wrapper">
        <section class="card" aria-labelledby="pageTitle">
          <h1 class="title" id="pageTitle">Carga de im√°genes</h1>
          <p class="subtitle">
            Selecciona una imagen desde tu computadora para previsualizarla y
            subirla.
          </p>

          <div class="center">
            <input type="file" id="fileInput" accept="image/*" hidden />
            <button class="btn btn-outlined" id="chooseBtn" type="button">
              ELEGIR IMAGEN
            </button>
            <div id="fileInfo" class="file-info" aria-live="polite"></div>
          </div>

          <div class="preview" id="previewContainer" style="display: none">
            <img
              id="previewImg"
              class="preview-image"
              alt="Vista previa de la imagen seleccionada"
              loading="lazy"
              decoding="async"
              width="200"
              height="200"
            />
          </div>

          <div class="progress-bar" id="progressBar" aria-hidden="true">
            <div class="progress-inner"></div>
          </div>

          <button class="btn btn-contained" id="uploadBtn" type="button">
            SUBIR IMAGEN
          </button>

          <!-- Galer√≠a -->
          <section class="gallery-section" aria-label="Galer√≠a de im√°genes">
            <h2 class="gallery-title">Galer√≠a</h2>

            <!-- Skeleton (decorativo) -->
            <div class="gallery-grid" id="skeletonGallery" aria-hidden="true">
              <div class="skeleton-card">
                <div class="skeleton-block"></div>
                <div class="skeleton-line long"></div>
                <div class="skeleton-line short"></div>
              </div>
              <div class="skeleton-card">
                <div class="skeleton-block"></div>
                <div class="skeleton-line long"></div>
                <div class="skeleton-line short"></div>
              </div>
              <div class="skeleton-card">
                <div class="skeleton-block"></div>
                <div class="skeleton-line long"></div>
                <div class="skeleton-line short"></div>
              </div>
            </div>

            <!-- Galer√≠a real -->
            <div class="gallery-grid" id="realGallery" style="display: none">
              <!-- Se llena por JS -->
            </div>
          </section>
        </section>
      </div>
    </main>

    <!-- Dialog mensajes (√©xito / error) -->
    <div class="dialog-backdrop" id="dialogBackdrop" role="presentation">
      <div
        class="dialog"
        role="dialog"
        aria-modal="true"
        aria-labelledby="dialogTitle"
        aria-describedby="dialogMessage"
      >
        <div class="dialog-header" id="dialogHeader">
          <span class="chip" id="dialogChip">!</span>
          <span id="dialogTitle">Mensaje</span>
        </div>
        <div class="dialog-body" id="dialogMessage" aria-live="polite"></div>
        <div class="dialog-footer">
          <button class="btn btn-outlined" id="dialogCloseBtn" type="button">
            Entendido
          </button>
        </div>
      </div>
    </div>

    <!-- Dialog confirmaci√≥n de eliminaci√≥n -->
    <div class="dialog-backdrop" id="confirmBackdrop" role="presentation">
      <div
        class="dialog"
        role="dialog"
        aria-modal="true"
        aria-labelledby="confirmTitle"
        aria-describedby="confirmMessage"
      >
        <div class="dialog-header error">
          <span class="chip error">!</span>
          <span id="confirmTitle">Confirmar eliminaci√≥n</span>
        </div>
        <div class="dialog-body" id="confirmMessage"></div>
        <div class="dialog-footer">
          <button class="btn btn-outlined" id="confirmCancelBtn" type="button">
            Cancelar
          </button>
          <button class="btn btn-text" id="confirmDeleteBtn" type="button">
            Eliminar
          </button>
        </div>
      </div>
    </div>

    <script>
      const fileInput = document.getElementById("fileInput");
      const chooseBtn = document.getElementById("chooseBtn");
      const uploadBtn = document.getElementById("uploadBtn");
      const fileInfo = document.getElementById("fileInfo");
      const previewContainer = document.getElementById("previewContainer");
      const previewImg = document.getElementById("previewImg");
      const progressBar = document.getElementById("progressBar");

      const skeletonGallery = document.getElementById("skeletonGallery");
      const realGallery = document.getElementById("realGallery");

      const dialogBackdrop = document.getElementById("dialogBackdrop");
      const dialogHeader = document.getElementById("dialogHeader");
      const dialogTitle = document.getElementById("dialogTitle");
      const dialogMessage = document.getElementById("dialogMessage");
      const dialogChip = document.getElementById("dialogChip");
      const dialogCloseBtn = document.getElementById("dialogCloseBtn");

      const confirmBackdrop = document.getElementById("confirmBackdrop");
      const confirmMessage = document.getElementById("confirmMessage");
      const confirmCancelBtn = document.getElementById("confirmCancelBtn");
      const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");

      let selectedFile = null;
      let images = [
        { url: "1.sm.webp", name: "page1.webp", size: 145000 },
        { url: "2.sm.webp", name: "snowboard.webp", size: 98000 },
        { url: "3.sm.webp", name: "Nature.webp", size: 164500 },
      ];
      let deleteIndex = null;
      let lastFocusedElement = null;

      function formatKB(size) {
        return (size / 1024).toFixed(1) + " KB";
      }

      function renderGallery(list) {
        realGallery.innerHTML = "";
        list.forEach((img, index) => {
          const card = document.createElement("article");
          card.className = "gallery-card";
          card.setAttribute("aria-label", `Imagen ${index + 1}: ${img.name}`);

          const image = document.createElement("img");
          image.className = "gallery-img";
          image.src = img.url;
          image.alt = `Vista previa de ${img.name}`;
          image.width = 320;
          image.height = 140;
          image.decoding = "async";
          if (index > 0) {
            image.loading = "lazy";
          }

          const name = document.createElement("div");
          name.className = "gallery-name";
          name.textContent = img.name;

          const footer = document.createElement("div");
          footer.className = "gallery-footer";

          const size = document.createElement("div");
          size.className = "gallery-size";
          size.textContent = formatKB(img.size);

          const deleteBtn = document.createElement("button");
          deleteBtn.type = "button";
          deleteBtn.className = "btn btn-text";
          deleteBtn.textContent = "Eliminar";
          deleteBtn.setAttribute("aria-label", `Eliminar imagen ${img.name}`);
          deleteBtn.addEventListener("click", () => {
            openConfirmDialog(index, img.name);
          });

          footer.appendChild(size);
          footer.appendChild(deleteBtn);

          card.appendChild(image);
          card.appendChild(name);
          card.appendChild(footer);

          realGallery.appendChild(card);
        });
      }

      function openDialog(type, message) {
        lastFocusedElement = document.activeElement;
        dialogMessage.textContent = message;
        dialogBackdrop.style.display = "flex";

        if (type === "error") {
          dialogTitle.textContent = "Ocurri√≥ un error";
          dialogHeader.classList.remove("success");
          dialogHeader.classList.add("error");
          dialogChip.classList.remove("success");
          dialogChip.classList.add("error");
          dialogChip.textContent = "!";
        } else {
          dialogTitle.textContent = "Operaci√≥n exitosa";
          dialogHeader.classList.remove("error");
          dialogHeader.classList.add("success");
          dialogChip.classList.remove("error");
          dialogChip.classList.add("success");
          dialogChip.textContent = "‚úì";
        }

        dialogCloseBtn.focus();
      }

      function closeDialog() {
        dialogBackdrop.style.display = "none";
        if (lastFocusedElement) {
          lastFocusedElement.focus();
        }
      }

      function openConfirmDialog(index, name) {
        deleteIndex = index;
        lastFocusedElement = document.activeElement;
        confirmMessage.textContent = `¬øEst√°s seguro de que deseas eliminar la imagen "${name}"?`;
        confirmBackdrop.style.display = "flex";
        confirmDeleteBtn.focus();
      }

      function closeConfirmDialog() {
        confirmBackdrop.style.display = "none";
        deleteIndex = null;
        if (lastFocusedElement) {
          lastFocusedElement.focus();
        }
      }

      dialogCloseBtn.addEventListener("click", closeDialog);
      dialogBackdrop.addEventListener("click", (e) => {
        if (e.target === dialogBackdrop) closeDialog();
      });

      confirmCancelBtn.addEventListener("click", closeConfirmDialog);
      confirmBackdrop.addEventListener("click", (e) => {
        if (e.target === confirmBackdrop) closeConfirmDialog();
      });

      confirmDeleteBtn.addEventListener("click", () => {
        if (deleteIndex !== null) {
          images.splice(deleteIndex, 1);
          renderGallery(images);
          closeConfirmDialog();
          openDialog("success", "La imagen se elimin√≥ correctamente.");
        }
      });

      chooseBtn.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        if (!file.type.startsWith("image/")) {
          openDialog(
            "error",
            "Solo se permiten archivos de imagen (jpg, png, etc.)."
          );
          fileInput.value = "";
          return;
        }

        selectedFile = file;
        fileInfo.innerHTML = `Archivo: <strong>${
          file.name
        }</strong> ‚Äî ${formatKB(file.size)}`;

        const url = URL.createObjectURL(file);
        previewImg.src = url;
        previewContainer.style.display = "flex";
      });

      uploadBtn.addEventListener("click", () => {
        if (!selectedFile) {
          openDialog("error", "Primero selecciona una imagen üôÉ");
          return;
        }

        uploadBtn.disabled = true;
        uploadBtn.textContent = "Subiendo...";
        progressBar.style.display = "block";

        setTimeout(() => {
          progressBar.style.display = "none";
          uploadBtn.disabled = false;
          uploadBtn.textContent = "SUBIR IMAGEN";

          images.push({
            url: previewImg.src,
            name: selectedFile.name,
            size: selectedFile.size,
          });
          renderGallery(images);

          openDialog(
            "success",
            `Imagen "${selectedFile.name}" subida correctamente (simulado).`
          );

          selectedFile = null;
          fileInput.value = "";
          fileInfo.textContent = "";
          previewContainer.style.display = "none";
        }, 2000);
      });

      // Mostrar skeleton 2s y luego la galer√≠a
      renderGallery(images);
      setTimeout(() => {
        skeletonGallery.style.display = "none";
        realGallery.style.display = "grid";
      }, 2000);
    </script>
  </body>
</html>
